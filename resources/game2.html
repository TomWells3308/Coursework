<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Old Maid</title>
        <script type="module" src="/client/js/js.cookie.min.js"></script>
        <script>
            let w=0,h=0,a=0,b=0;
            let hands = [];
            let cardImageFiles = ["10C.png", "9C.png", "8C.png", "7C.png", "6C.png", "5C.png", "4C.png", "3C.png", "2C.png", "10S.png", "9S.png", "8S.png", "7S.png", "6S.png", "5S.png", "4S.png", "3S.png", "2S.png", "10D.png", "9D.png", "8D.png", "7D.png", "6D.png", "5D.png", "4D.png", "3D.png", "2D.png","10H.png", "9H.png", "8H.png", "7H.png", "6H.png", "5H.png", "4H.png", "3H.png", "2H.png","JH.png", "AH.png", "KH.png", "QH.png", "JS.png", "AS.png", "KS.png", "QS.png", "JD.png", "AD.png", "KD.png", "QD.png", "JC.png", "AC.png", "KC.png", "QC.png"];
            let cards = [];

            function fixSize() {
                w = window.innerWidth;
                h = window.innerHeight;
                const canvas = document.getElementById("game2");
                canvas.width = w;
                canvas.height = h;
            }

            function shuffle(array){
                let currentIndex = array.length, temporaryValue, randomIndex;

                while (0 !== currentIndex){
                    randomIndex = Math.floor(Math.random()*currentIndex);
                    currentIndex -= 1;

                    temporaryValue=array[currentIndex];
                    array[currentIndex] = array[randomIndex];
                    array[randomIndex] = temporaryValue;
                }
                return array;
            }

            function giveHands(){
                let array = [];
                let k = 0;
                let players = parseInt(Cookies.get('setting1'));
                console.log(Math.round(52/players));
                hands = createArray(players, Math.round(52/players));
                array = shuffle(cardImageFiles);
                console.log(array);
                console.log(players);
                for(let j = 0; j <= 62-players; j += players){
                    for(let i = 0; i <= players-1; i++){
                        if(j+1 < 53){
                            console.log("Number = " + (j+i).toString() + " to hand number " + i.toString());
                            hands[i][k] = array[j+i];
                        }
                    }
                    k++;
                }
                console.log(hands);
            }

            let loadCardImages = new Promise(function(resolve) {

                let loadedImageCount = 0;

                let loadCheck = function() {
                    loadedImageCount++;
                    if (loadedImageCount === cardImageFiles.length) {
                        console.log("Success!");
                        resolve();
                    }
                };

                for (let c of cardImageFiles) {
                    let img = new Image();
                    img.src = "/client/img/" +  + c;
                    console.log("Loading " + c);
                    img.onload = () => loadCheck();
                    cards.push(img);
                }

            });

            function createArray(length) {
                let arr = new Array(length || 0),
                    i = length;

                if (arguments.length > 1) {
                    let args = Array.prototype.slice.call(arguments, 1);
                    while(i--) arr[length-1 - i] = createArray.apply(this, args);
                }
                return arr;
            }

            function pageLoad(){

                window.addEventListener("resize", fixSize);
                fixSize();
                giveHands();

                loadCardImages.then(() => {
                    window.requestAnimationFrame(redraw);
                });

            }

            function redraw(){
                const canvas = document.getElementById("game2");
                const context = canvas.getContext("2d");

                let cardScale = 1.0;
                if (w < 1920) {
                    cardScale = 1 - (1920 - w) / 1920;
                }

                context.fillStyle = "#400101";
                context.fillRect(0, 0, w, h);

                let spacing1 = w / (p1Hand.length + 4);
                for(let i = 0; i < p1Hand.length; i++){
                    console.log("Drawing image " + p1Hand[i]);
                    context.drawImage(p1Hand[i], + (i+1.5)*spacing1, h-350*cardScale, 200*cardScale, 300*cardScale);
                }

                window.requestAnimationFrame(redraw);
            }
        </script>
    </head>
    <body onload="pageLoad()" style="min-width: 800px; margin: 0; overflow: hidden">
    <div style="width: 100%;">
        <canvas id="game2"></canvas>
    </div>
    </body>
</html>